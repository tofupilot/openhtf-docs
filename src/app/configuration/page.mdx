export const metadata = {
  title: 'Configuration',
  description:
    'Explore how to manage test settings with OpenHTFâ€™s configuration module, allowing for adaptable, maintainable, and scalable test scripts using both in-code definitions and external configuration files.',
}

# Configurations

You can control test settings with configuration variables or files. {{ className: 'lead' }}

<Image
  src="/configuration-header.png"
  alt="Header of the OpenHTF documentation showing Configuration details and integration with TofuPilot."
/>

## Overview

It is sometimes necessary to change some parameters in a script without modifying the script itself each time. For example, you might need to update the firmware version flashed on a PCB using a script, or adjust the connection port of an instrument between two stations running the same script.

OpenHTF makes it easy to manage these parameters using configuration files.

## Variables

You can set configuration variables directly in the script using the `conf` module.

```python {{ title: 'main.py' }}
from openhtf import Test
from openhtf.util import configuration

# Define firmware_path configuration
configuration.declare('firmware_path', default_value='path/to/firmware_v1.0.0.bin', description='Path to the firmware file')

def flash_firmware(test):
    firmware_path = conf.firmware_path
    print(f'Flashing firmware from: {firmware_path}')

def main():
    test = Test(flash_firmware)
    test.execute(test_start=lambda: 'DeviceUnderTest123')

if __name__ == '__main__':
    main()
```

You can set the following parameters for each configuration variable in OpenHTF:

<Properties>
  <Property name=".name">
    The unique identifier for the configuration variable (must be in
    snake_case).
  </Property>
  <Property name=".default_value">
    An optional value that serves as the default if no other value is provided.
  </Property>
  <Property name=".description">
    An optional description explaining the purpose of the configuration
    variable.
  </Property>
</Properties>

## File

You can load configurations from an external file written in YAML or JSON format. For example:

```yaml {{ title: 'config.yaml' }}
firmware_path: 'path/to/firmware_v1.0.0.bin'
```

Load the configuration file during execution script:

```python {{ title: 'main.py' }}
import openhtf as htf
import logging
from openhtf.util import conf

# Declare the firmware_path key
conf.declare('firmware_path')

# Load configuration from an external YAML file
with open('config.yaml', 'r') as yamlfile:
    conf.load_from_file(yamlfile)

def flash_firmware(test):
    firmware_path = conf.firmware_path  # Access the declared configuration key
    print(f'Flashing firmware from: {firmware_path}')

def main():
    logging.basicConfig(level=logging.INFO)
    test = htf.Test(flash_firmware)
    test.execute(test_start=lambda: 'DeviceUnderTest123')

if __name__ == '__main__':
    main()
```
