export const metadata = {
  title: 'Device Under Test (DUT)',
  description:
    'Learn how to track and record the Device Under Test (DUT) serial number in OpenHTF tests. This guide covers operator prompts, setting programmatically, and TofuPilot integration for full traceability.',
  keywords: [
    'OpenHTF',
    'DUT',
    'Device Under Test',
    'Unit Under Test',
    'test serial number',
    'traceability',
    'TofuPilot integration',
    'hardware testing',
  ],
  author: 'TofuPilot',
  og: {
    title: 'Device Under Test (DUT) in OpenHTF',
    description:
      'Learn how to record and manage Device Under Test (DUT) serial numbers in OpenHTF tests with full traceability, including TofuPilot integration.',
    image: '/dut-header.png',
  },
  twitter: {
    card: 'summary_large_image',
    site: '@YourTwitterHandle',
    title: 'Device Under Test (DUT) in OpenHTF',
    description:
      'This guide explains how to handle Device Under Test (DUT) serial numbers in OpenHTF, with operator prompts and TofuPilot integration.',
    image: '/dut-header.png',
  },
}

# Device Under Test

You can track the serial number of the unit under test with every test run. {{ className: 'lead' }}

<Image
  src="/dut-header.png"
  alt="OpenHTF Device Under Test (DUT) documentation section header with TofuPilot."
/>

## Overview

When you're testing devices, you usually need to track the serial number of each unit for test traceability. With OpenHTF, you can track the serial number by:

- Having the operator enter it manually.
- Setting it at the start.
- Setting it during the test.

With TofuPilot integration, it will automatically:

- Create a new unit during the first test run where the serial number is detected.
- Link test results to the corresponding unit.
- Track the unitâ€™s history across all test procedures.

## Prompt at start

You can prompt the operator to input the serial number manually at the start of the test.

```python {{ title: 'main.py' }}
from openhtf import Test, PhaseResult
from openhtf.plugs import user_input

def phase_power_on(test):
    return PhaseResult.CONTINUE

def main():
    test = Test(phase_power_on)
    # Operator enters serial number at test start
    test.execute(test_start=user_input.prompt_for_test_start())

if __name__ == '__main__':
    main()
```

This script runs from the command line, where the operator enters the device name "SI051AB7B0001".

```sh
(venv) C:\tofupilot > python main.py
Enter a DUT ID in order to start the test.
--> SI051AB7B0001

======================= test: openhtf_test  outcome: PASS ======================
```

## Set at start

You can set the serial number at the start of the test.

```python {{ title: 'main.py' }}
from openhtf import Test, PhaseResult

def phase_power_on(test):
    return PhaseResult.CONTINUE

def main():
    test = Test(phase_power_on)
    # Serial number set at test start
    test.execute(test_start=lambda: 'SI051AB7B0001')

if __name__ == '__main__':
    main()
```

## Set during test

You can also set the serial number during the test.

```python {{ title: 'main.py' }}
from openhtf import Test, PhaseResult

def phase_get_sn(test):
    # Serial number captured during test
    test.test_record.dut_id = 'SI051AB7B0001'
    return PhaseResult.CONTINUE

def main():
    test = Test(phase_get_sn)
    test.execute()

if __name__ == '__main__':
    main()
```

## TofuPilot integration

TofuPilot works seamlessly with OpenHTF reports using the `dut_id` for the serial number.

- If the unit was created in a previous test, no action is needed.
- If not, specify the `part_number`.
- Optionally, add the `revision`. If none is provided, 'A' is used by default.

This example extracts the part number and revision from the serial number, but you can also set them manually.

```python {{ title: 'main.py' }}
from openhtf import Test, PhaseResult

def phase_get_pn_rev(test):
    # Extract the part number and revision from the serial number
    test.test_record.part_number = test.test_record.dut_id[:5]
    test.test_record.revision = test.test_record.dut_id[5:7]
    return PhaseResult.CONTINUE

def main():
    test = Test(
        phase_get_pn_rev,
        procedure_id="FVT1", # Procedure ID in TofuPilot
    )
    # TofuPilot callback
    # TODO Felix

    # Serial number set at test start
    test.execute(test_start=lambda: 'SI051AB7B0001')

if __name__ == '__main__':
    main()
```

On the run page in TofuPilot, a link is available to the unit under test page.

<Image
  srcLight="/header-dut.png"
  srcDark="/header-dut.png"
  alt="OpenHTF Device Under Test (DUT) documentation section header with TofuPilot."
/>

On the unit page, you can see all test runs performed on this unit across all procedures.

<Image
  srcLight="/header-dut.png"
  srcDark="/header-dut.png"
  alt="OpenHTF Device Under Test (DUT) documentation section header with TofuPilot."
/>
