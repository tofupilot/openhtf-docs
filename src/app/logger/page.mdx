export const metadata = {
  title: 'Logging',
  description:
    'Explore how to configure logger options in OpenHTF to capture and manage log output during test execution, with examples of standard and custom log handlers.',
}

# Logger

Capture structured log output during test execution. {{ className: 'lead' }}

<Image
  src="/console-header.png"
  alt="OpenHTF Device Under Test (DUT) documentation section header with TofuPilot."
/>

## Overview

Logging is crucial for debugging and tracking test execution. OpenHTF offers a logger that captures detailed outputs, custom messages, and error traces, which are saved to test records through output callbacks.

{/* When integrating with <TofuPilotLink utmMedium="logger-overview" />, logs are automatically synced to TofuPilot, providing real-time access to test execution details. This helps ensure that critical information is always available for analysis. You can also configure additional logging options if you need to store logs locally for further investigation. */}

## Syntax

You can log events in phases and plugs with four different levels depending on the severity: `debug` for detailed troubleshooting, `info` for general information, `warning` for potential issues, and `error` for failures.

```python {{ title: 'main.py' }}
from openhtf import Test, plugs
from openhtf.output.callbacks import json_factory

class MyPlug(plugs.BasePlug):
    def do_something(self):
        self.logger.debug('Plug debugging details...')

@plugs.plug(my_plug=MyPlug)
def phase_test(test, my_plug):
    test.logger.info('Test phase started.')
    test.logger.warning('Warning in test phase: Potential issue.')
    try:
        raise ValueError('Error occurred in test phase.')
    except ValueError as e:
        test.logger.error(f'Test phase error: {e}')
    my_plug.do_something()

def main():
    test = Test(phase_test)
    test.add_output_callbacks(json_factory.OutputToJSON("test_result.json", indent=2))
    test.execute(lambda: "PCB001")

if __name__ == "__main__":
    main()
```

You can print the logs to the console, using the `-v` flag to control verbosity.

```sh
python main.py -v
```

- Default: No logs are printed.
- `-v`: Logs at the `info` level and above are printed.
- `-vv`: Logs at the `debug` level and above are printed.

```txt {{ title: 'Terminal' }}
I 08:19:08 <phase: phase_test> - Test phase started.
W 08:19:08 <phase: phase_test> - Warning in test phase: Potential issue.
E 08:19:08 <phase: phase_test> - Test phase error: Error occurred in test phase.
```

All logs are saved to the report file via output callbacks if enabled.

```javascript {{ title: 'test_results.json' }}
"log_records": [
    {
      "level": 30,
      "logger_name": "openhtf.test_record.<test_uid>.phase.phase_test",
      "source": "main.py",
      "lineno": 11,
      "timestamp_millis": 1729163738931,
      "message": "Warning in test phase: Potential issue."
    },
  ...
]
```

---

## Advanced use cases

You can use the logger extended features for advanced use cases.

### Logger architecture

OpenHTF organizes its loggers hierarchically, with different categories managing parts of the framework and test executions.

```txt
openhtf/
│
├── openhtf.core.test_executor
├── openhtf.core.threads
│
├── openhtf.test_record.<test_uid>
│   ├── openhtf.test_record.<test_uid>.phase.<phase_name>
│   └── openhtf.test_record.<test_uid>.plug.<plug_name>
```

- **Framework logs**: Manage internal logs for core OpenHTF operations (e.g., `test_executor`, `threads`).
- **Test record logs**: Specific to each test, prefixed by `openhtf.test_record.<test_uid>`, capturing test details attached to the record.
- **Test subsystem logs**: Handle logs for individual test phases and plugs, identified by `openhtf.test_record.<test_uid>.phase.<phase_name>` or `openhtf.test_record.<test_uid>.plug.<plug_name>`.

### Custom logger

You can customize the logger format.

```python {{ title: 'main.py' }}
import openhtf as htf
import logging

# Define a test phase that logs information
@htf.measures(htf.Measurement('temperature').with_units('C'))
def temperature_measurement(test):
    test.logger.info('Temperature measurement started.')
    test.measurements.temperature = 25
    test.logger.info('Temperature measurement completed.')

def main():
    # Get the OpenHTF logger
    logger = logging.getLogger('openhtf')

    # Create a custom log format with additional details:
    # - %(asctime)s: Adds a timestamp to each log message.
    # - %(name)s: Includes the name of the logger (in this case, 'openhtf').
    # - %(levelname)s: Logs the level of the message (INFO, DEBUG, WARNING, ERROR, etc.).
    # - %(lineno)d: Adds the line number where the log was created.
    # - %(message)s: The actual log message.
    formatter = logging.Formatter(
        '%(asctime)s | %(name)s | [%(levelname)s] | Line: %(lineno)d | %(message)s'
    )

    # Create a stream handler that will output logs to the console (stdout)
    handler = logging.StreamHandler()

    # Apply the custom format to the handler
    handler.setFormatter(formatter)

    # Attach the handler to the logger
    logger.addHandler(handler)

    # Set the logging level to INFO (it will log INFO, WARNING, and ERROR messages)
    logger.setLevel(logging.INFO)

    test = htf.Test(temperature_measurement)
    test.execute(test_start=lambda: 'PCB001')

if __name__ == '__main__':
    main()
```

Sample output:

```txt {{ title: 'Terminal' }}
729164561420.phase_executor | [DEBUG] | Line: 307 | Executing phase temperature_measurement
2024-10-17 13:29:21,423 | openhtf.test_record.29452:<test_uid>.phase.temperature_measurement | [INFO] | Line: 7 | Temperature measurement started.
```
